CREATE TABLE `scenes` (
  `id` int UNSIGNED NOT NULL,
  `name` varchar(300) NOT NULL,
  `author_id` bigint UNSIGNED NOT NULL,
  `disciplina_id` bigint UNSIGNED NOT NULL,
  `start_panel_id` int NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE `scenes`
  ADD PRIMARY KEY (`id`),
  ADD KEY `disciplina_id_foreign` (`disciplina_id`),
  ADD KEY `author_id_foreign` (`author_id`),
  ADD KEY `start_panel_id_foreign` (`start_panel_id`);

ALTER TABLE `scenes`
  MODIFY `id` int UNSIGNED NOT NULL AUTO_INCREMENT;

ALTER TABLE `scenes`
  ADD CONSTRAINT `author_id_foreign` FOREIGN KEY (`author_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `disciplina_id_foreign` FOREIGN KEY (`disciplina_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `start_panel_id_foreign` FOREIGN KEY (`start_panel_id`) REFERENCES `paineis` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE `buttons` (
  `id` int NOT NULL,
  `origin_id` int NOT NULL,
  `destination_id` int NOT NULL,
  `configurations` varchar(1000) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE `buttons`
  ADD PRIMARY KEY (`id`),
  ADD KEY `destination_panel_id_foreign` (`destination_id`);


ALTER TABLE `buttons`
  ADD CONSTRAINT `destination_panel_id_foreign` FOREIGN KEY (`destination_id`) REFERENCES `paineis` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  ADD CONSTRAINT `origin_panel_id_foreign` FOREIGN KEY (`origin_id`) REFERENCES `paineis` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE buttons CHANGE destination_id destination_id INT NULL;
ALTER TABLE activities CHANGE painel_inicial_id scene_id_foreing INT NULL DEFAULT NULL;
ALTER TABLE activities DROP FOREIGN KEY painel_inicial_foreign_key; 
ALTER TABLE activities DROP INDEX painel_inicial_foreign_key;
ALTER TABLE activities CHANGE scene_id_foreing scene_id INT UNSIGNED NULL DEFAULT NULL;
ALTER TABLE activities ADD CONSTRAINT scene_id_foreign FOREIGN KEY (scene_id) REFERENCES scenes(id) ON DELETE SET NULL ON UPDATE CASCADE;
ALTER TABLE paineis ADD scene_id INT UNSIGNED NOT NULL;
ALTER TABLE activities DROP FOREIGN KEY scene_id_foreign;
ALTER TABLE activities ADD CONSTRAINT scene_id_foreign FOREIGN KEY (scene_id) REFERENCES scenes(id) ON DELETE SET NULL ON UPDATE CASCADE;

ALTER TABLE paineis ADD CONSTRAINT scene_id_foreing FOREIGN KEY (scene_id) REFERENCES scenes(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE scenes CHANGE start_panel_id start_panel_id INT NULL;
ALTER TABLE scenes ADD created_at DATE NOT NULL;
ALTER TABLE scenes ADD updated_at DATE NOT NULL;
ALTER TABLE buttons ADD created_at DATE NOT NULL;
ALTER TABLE buttons ADD updated_at DATE NOT NULL;
ALTER TABLE scenes DROP FOREIGN KEY disciplina_id_foreign;
ALTER TABLE scenes ADD CONSTRAINT disciplina_id_foreign FOREIGN KEY (disciplina_id) REFERENCES disciplinas(id) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE scenes CHANGE disciplina_id disciplina_id BIGINT UNSIGNED NULL;

ALTER TABLE buttons CHANGE id id INT NOT NULL AUTO_INCREMENT;
ALTER TABLE buttons CHANGE destination_id destination_id INT NULL;
